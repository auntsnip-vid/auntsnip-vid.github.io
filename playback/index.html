<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Feed</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:sans-serif;
}
.feed{
  height:100%;
  overflow-y:scroll;
  scroll-snap-type:y mandatory;
}
.item{
  height:100%;
  position:relative;
  scroll-snap-align:start;
}
video{
  width:100%;
  height:100%;
  object-fit:cover;
}
.user{
  position:absolute;
  bottom:20px;
  left:12px;
  color:#fff;
  font-size:14px;
}
.social{
  position:absolute;
  right:12px;
  bottom:90px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:18px;
  color:#fff;
  font-size:12px;
}
.social .avatar{
  width:48px;
  height:48px;
  border-radius:50%;
  background-size:cover;
  background-position:center;
  border:2px solid #fff;
}
.social .btn{
  display:flex;
  flex-direction:column;
  align-items:center;
}
.social .icon{font-size:22px}
.social .count{font-size:11px;opacity:.85}
</style>
</head>

<body>
<div class="feed" id="feed"></div>

<script>
/* ===== LOAD DATA ===== */
let VIDEO_LIST = [];
let START_INDEX = 0;

try{
  VIDEO_LIST = JSON.parse(localStorage.getItem("VIDEO_LIST")) || [];
  START_INDEX = Number(localStorage.getItem("START_INDEX")) || 0;
}catch(e){
  location.href="index.html";
}

if(!VIDEO_LIST.length){
  location.href="index.html";
}

/* ===== ROTATE LIST (INFINITE) ===== */
const ordered = [
  ...VIDEO_LIST.slice(START_INDEX),
  ...VIDEO_LIST.slice(0, START_INDEX)
];

const feed = document.getElementById("feed");

/* ===== RENDER ===== */
ordered.forEach(v=>{
  const likes = Math.floor(Math.random()*9000)+1000;
  const comments = Math.floor(Math.random()*4000)+300;

  const d = document.createElement("div");
  d.className = "item";
  d.dataset.id = v.id || v.src.split("/").pop().replace(".mp4","");

  d.innerHTML = `
    <video src="${v.src}" muted playsinline></video>

    <div class="social">
      <div class="avatar" style="background-image:url('${v.avatar}')"></div>
      <div class="btn"><div class="icon">â™¥</div><div class="count">${likes}</div></div>
      <div class="btn"><div class="icon">ðŸ’¬</div><div class="count">${comments}</div></div>
    </div>

    <div class="user">${v.user}</div>
  `;
  feed.appendChild(d);
});

/* ===== URL UPDATE ===== */
function updateURL(id){
  const url = new URL(location);
  url.searchParams.set("vid", id);
  history.replaceState({}, "", url);
}

/* ===== OBSERVER (PLAY 1 VIDEO ONLY) ===== */
const observer = new IntersectionObserver(entries=>{
  entries.forEach(entry=>{
    const video = entry.target.querySelector("video");
    if(entry.isIntersecting){
      video.play();
      updateURL(entry.target.dataset.id);
    }else{
      video.pause();
    }
  });
},{threshold:0.6});

document.querySelectorAll(".item").forEach(item=>{
  observer.observe(item);
});

/* ===== START FROM URL IF EXIST ===== */
const params = new URLSearchParams(location.search);
const vid = params.get("vid");
if(vid){
  const target = [...document.querySelectorAll(".item")]
    .find(el=>el.dataset.id===vid);
  if(target){
    feed.scrollTo({top:target.offsetTop,behavior:"instant"});
  }
}
</script>

<!-- Histats.com  START  (aync)-->
<script type="text/javascript">var _Hasync= _Hasync|| [];
_Hasync.push(['Histats.start', '1,4992245,4,511,95,18,00000000']);
_Hasync.push(['Histats.fasi', '1']);
_Hasync.push(['Histats.track_hits', '']);
(function() {
var hs = document.createElement('script'); hs.type = 'text/javascript'; hs.async = true;
hs.src = ('//s10.histats.com/js15_as.js');
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(hs);
})();</script>
<noscript><a href="/" target="_blank"><img  src="//sstatic1.histats.com/0.gif?4992245&101" alt="" border="0"></a></noscript>
<!-- Histats.com  END  -->

</body>
</html>
